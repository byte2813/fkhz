
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/smallBlock.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '89607/2ujVCPIKWlsifKPJo', 'smallBlock');
// scripts/smallBlock.js

"use strict";

var global = require('global');

var changeposition = 0; //用于计算在数组中的位置

var changeangle = 0; //用于计算角度

cc.Class({
  "extends": cc.Component,
  properties: {
    color: '',
    collider: {
      "default": null,
      type: cc.PolygonCollider
    },
    blocktype: ''
  },
  start: function start() {
    this._oldPos = this.node.position; // console.log(this._oldPos)
  },
  onLoad: function onLoad() {
    cc.director.getCollisionManager().enabled = true; // cc.director.getCollisionManager().enabledDebugDraw = true;

    this.hit = false; // 触摸事件开始

    this.node.on(cc.Node.EventType.TOUCH_START, function (touch, event) {
      var touchLoc = touch.getLocation();

      if (cc.Intersection.pointInPolygon(touchLoc, this.collider.world.points)) {
        console.log(this.node.blocktype);
        this.hit = true; // 启用缓动动画
        // cc.tween(this.node).to(.15, {
        //   position: cc.v2(touchLoc.x - this.node.parent.width / 2, touchLoc.y - this.node.parent.height / 2)
        // }, {
        //   easing: 'quadIn'
        // }).start()

        if (this.hit && this.node.blocktype == 'small') {
          this.node.x = touchLoc.x - this.node.parent.width / 2;
          this.node.y = touchLoc.y - this.node.parent.height / 2;
        }
      }
    }, this); // 触摸事件监听

    this.node.on(cc.Node.EventType.TOUCH_MOVE, function (touch, event) {
      var touchLoc = touch.getLocation();

      if (this.hit && this.node.blocktype == 'small') {
        this.node.x += touch.getDelta().x;
        this.node.y += touch.getDelta().y;
        touchLoc.x = touchLoc.x - this.node.parent.width / 2;
        touchLoc.y = touchLoc.y - this.node.parent.height / 2;

        if (touchLoc.x > 0 && touchLoc.y > 0) {
          this.node.angle = Math.atan(touchLoc.y / touchLoc.x) / Math.PI * 180 + 90 - 22.5;
        } else if (touchLoc.x < 0 && touchLoc.y > 0) {
          this.node.angle = Math.atan(-touchLoc.x / touchLoc.y) / Math.PI * 180 + 180 - 22.5;
        } else if (touchLoc.x < 0 && touchLoc.y < 0) {
          this.node.angle = Math.atan(-touchLoc.y / -touchLoc.x) / Math.PI * 180 + 270 - 22.5;
        } else if (touchLoc.x > 0 && touchLoc.y < 0) {
          this.node.angle = Math.atan(touchLoc.x / -touchLoc.y) / Math.PI * 180 - 22.5;
        } else if (touchLoc.x == 0 && touchLoc.y > 0) {
          this.node.angle = 180 - 22.5;
        } else if (touchLoc.x == 0 && touchLoc.y < 0) {
          this.node.angle = 0 - 22.5;
        } else if (touchLoc.x > 0 && touchLoc.y == 0) {
          this.node.angle = 90 - 22.5;
        } else if (touchLoc.x < 0 && touchLoc.y == 0) {
          this.node.angle = 270 - 22.5;
        }
      }
    }, this); // 触摸事件结束

    this.node.on(cc.Node.EventType.TOUCH_END, function (touch, event) {
      var _this = this;

      if (this.hit && this.node.blocktype == 'small') {
        this.hit = false; // 记录当前放置的位置

        var currentindex = -1;
        var points = global.insidepoints; // 没有移动到圆环目标位置区域，移动到初始位置

        if (this.node.x * this.node.x + this.node.y * this.node.y > 474 * 474 / 4) {
          if (touch.getLocation().x - this.node.parent.width / 2 < 0) this.easeTo(this._oldPos.x, this._oldPos.y, 337.5, .2);else this.easeTo(this._oldPos.x, this._oldPos.y, -22.5, .2);
        } else {
          // 移动到了圆环目标位置区域
          if (this.node.x > 0 && this.node.y < 0) currentindex = this.node.x < -this.node.y ? 0 : 1;
          if (this.node.x > 0 && this.node.y > 0) currentindex = this.node.x > this.node.y ? 2 : 3;
          if (this.node.x < 0 && this.node.y > 0) currentindex = -this.node.x < this.node.y ? 4 : 5;
          if (this.node.x < 0 && this.node.y < 0) currentindex = -this.node.x > -this.node.y ? 6 : 7; // 标记当前位置是否为空

          var isempty = true; // 在对应圆环已放置的数组中查找

          global.insideblocks.forEach(function (item) {
            if (item.index == currentindex) isempty = false; // 找到说明当前位置不可用
          }); // 当前位置若为空

          if (isempty && this.node.x != 0 && this.node.y != 0) {
            //计算旋转角度
            global.Schangeangle += 45 * parseInt(this.game.rotateGridsS.string); //计算块的真正位置

            var n = (currentindex + global.Schangeposition) % 8;
            if (n < 0) n += 8; //放置块的缓动效果

            cc.tween(this.node).to(.2, {
              x: points[currentindex].x,
              y: points[currentindex].y,
              angle: points[currentindex].a
            }, {
              easing: 'quadIn'
            }).call(function () {
              //放置块
              _this.node.x = points[n].x;
              _this.node.y = points[n].y;
              _this.node.angle = points[n].a; //更改块的父节点

              _this.node.removeFromParent(false);

              _this.game.inside.addChild(_this.node); //环旋转的缓动效果


              cc.tween(_this.game.inside).to(Math.abs(parseInt(_this.game.rotateGridsS.string)) / 4, {
                angle: global.Schangeangle
              }, {
                easing: 'quadIn'
              }).call(function () {
                _this.game.deleteBlock(); // 播放音效


                cc.audioEngine.playEffect(_this.game.rotateAudio, false);
              }).start();
            }).start(); // 构造当前块的对象，用于保存在圆环对象数组中

            var block = {
              index: currentindex,
              // 块的位置序号
              color: this.node.color._val,
              // 块的颜色
              rotateGridsS: this.game.rotateGridsS.string,
              // 块的转动格数
              blockitem: this
            }; // 保存在圆环对象数组中

            global.insideblocks.push(block); // 播放音效

            cc.audioEngine.playEffect(this.game.placeAudio, false); //计算在数组中的位置

            global.Schangeposition -= parseInt(this.game.rotateGridsS.string); //更新数组中所有块的位置

            global.insideblocks.forEach(function (item) {
              item.index = (item.index + parseInt(_this.game.rotateGridsS.string)) % 8;
              if (item.index < 0) item.index += 8;
            }); //console.log("global.insideblocks: ")
            //console.log(global.insideblocks)
            // 将当前块设置为不可点击

            this.node.blocktype = 'inside'; // 放置次数加1

            global.count++; // 如果三个块均已放置完毕，则重新生成三个块

            if (global.count != 0 && global.count % 3 == 0) {
              this.game.spawnBlock();
            }
          } else {
            // 当前位置若不为空，移动到初始位置
            if (touch.getLocation().x - this.node.parent.width / 2 < 0) this.easeTo(this._oldPos.x, this._oldPos.y, 337.5, .2);else this.easeTo(this._oldPos.x, this._oldPos.y, -22.5, .2);
          }
        }
      }
    }, this);
  },
  // 缓动函数
  easeTo: function easeTo(x, y, a, t) {
    cc.tween(this.node).to(t, {
      position: cc.v2(x, y),
      angle: a
    }, {
      easing: 'quadIn'
    }).start();
  },
  onDisable: function onDisable() {
    cc.director.getCollisionManager().enabled = false;
    cc.director.getCollisionManager().enabledDebugDraw = false;
    this.node.off(cc.Node.EventType.TOUCH_START);
    this.node.off(cc.Node.EventType.TOUCH_MOVE);
    this.node.off(cc.Node.EventType.TOUCH_END);
  },
  onDestroy: function onDestroy() {
    changeposition = 0;
    changeangle = 0;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcc21hbGxCbG9jay5qcyJdLCJuYW1lcyI6WyJnbG9iYWwiLCJyZXF1aXJlIiwiY2hhbmdlcG9zaXRpb24iLCJjaGFuZ2VhbmdsZSIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwiY29sb3IiLCJjb2xsaWRlciIsInR5cGUiLCJQb2x5Z29uQ29sbGlkZXIiLCJibG9ja3R5cGUiLCJzdGFydCIsIl9vbGRQb3MiLCJub2RlIiwicG9zaXRpb24iLCJvbkxvYWQiLCJkaXJlY3RvciIsImdldENvbGxpc2lvbk1hbmFnZXIiLCJlbmFibGVkIiwiaGl0Iiwib24iLCJOb2RlIiwiRXZlbnRUeXBlIiwiVE9VQ0hfU1RBUlQiLCJ0b3VjaCIsImV2ZW50IiwidG91Y2hMb2MiLCJnZXRMb2NhdGlvbiIsIkludGVyc2VjdGlvbiIsInBvaW50SW5Qb2x5Z29uIiwid29ybGQiLCJwb2ludHMiLCJjb25zb2xlIiwibG9nIiwieCIsInBhcmVudCIsIndpZHRoIiwieSIsImhlaWdodCIsIlRPVUNIX01PVkUiLCJnZXREZWx0YSIsImFuZ2xlIiwiTWF0aCIsImF0YW4iLCJQSSIsIlRPVUNIX0VORCIsImN1cnJlbnRpbmRleCIsImluc2lkZXBvaW50cyIsImVhc2VUbyIsImlzZW1wdHkiLCJpbnNpZGVibG9ja3MiLCJmb3JFYWNoIiwiaXRlbSIsImluZGV4IiwiU2NoYW5nZWFuZ2xlIiwicGFyc2VJbnQiLCJnYW1lIiwicm90YXRlR3JpZHNTIiwic3RyaW5nIiwibiIsIlNjaGFuZ2Vwb3NpdGlvbiIsInR3ZWVuIiwidG8iLCJhIiwiZWFzaW5nIiwiY2FsbCIsInJlbW92ZUZyb21QYXJlbnQiLCJpbnNpZGUiLCJhZGRDaGlsZCIsImFicyIsImRlbGV0ZUJsb2NrIiwiYXVkaW9FbmdpbmUiLCJwbGF5RWZmZWN0Iiwicm90YXRlQXVkaW8iLCJibG9jayIsIl92YWwiLCJibG9ja2l0ZW0iLCJwdXNoIiwicGxhY2VBdWRpbyIsImNvdW50Iiwic3Bhd25CbG9jayIsInQiLCJ2MiIsIm9uRGlzYWJsZSIsImVuYWJsZWREZWJ1Z0RyYXciLCJvZmYiLCJvbkRlc3Ryb3kiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsTUFBTSxHQUFHQyxPQUFPLENBQUMsUUFBRCxDQUFwQjs7QUFFQSxJQUFJQyxjQUFjLEdBQUcsQ0FBckIsRUFBdUI7O0FBQ3ZCLElBQUlDLFdBQVcsR0FBRyxDQUFsQixFQUFvQjs7QUFFcEJDLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ1AsYUFBU0QsRUFBRSxDQUFDRSxTQURMO0FBRVBDLEVBQUFBLFVBQVUsRUFBRTtBQUNWQyxJQUFBQSxLQUFLLEVBQUUsRUFERztBQUVWQyxJQUFBQSxRQUFRLEVBQUU7QUFDUixpQkFBUyxJQUREO0FBRVJDLE1BQUFBLElBQUksRUFBRU4sRUFBRSxDQUFDTztBQUZELEtBRkE7QUFNVkMsSUFBQUEsU0FBUyxFQUFFO0FBTkQsR0FGTDtBQVdQQyxFQUFBQSxLQVhPLG1CQVdDO0FBQ04sU0FBS0MsT0FBTCxHQUFlLEtBQUtDLElBQUwsQ0FBVUMsUUFBekIsQ0FETSxDQUVOO0FBQ0QsR0FkTTtBQWdCUEMsRUFBQUEsTUFoQk8sb0JBZ0JFO0FBQ1BiLElBQUFBLEVBQUUsQ0FBQ2MsUUFBSCxDQUFZQyxtQkFBWixHQUFrQ0MsT0FBbEMsR0FBNEMsSUFBNUMsQ0FETyxDQUVQOztBQUNBLFNBQUtDLEdBQUwsR0FBVyxLQUFYLENBSE8sQ0FLUDs7QUFDQSxTQUFLTixJQUFMLENBQVVPLEVBQVYsQ0FBYWxCLEVBQUUsQ0FBQ21CLElBQUgsQ0FBUUMsU0FBUixDQUFrQkMsV0FBL0IsRUFBNEMsVUFBVUMsS0FBVixFQUFpQkMsS0FBakIsRUFBd0I7QUFDbEUsVUFBSUMsUUFBUSxHQUFHRixLQUFLLENBQUNHLFdBQU4sRUFBZjs7QUFDQSxVQUFJekIsRUFBRSxDQUFDMEIsWUFBSCxDQUFnQkMsY0FBaEIsQ0FBK0JILFFBQS9CLEVBQXlDLEtBQUtuQixRQUFMLENBQWN1QixLQUFk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TU8sdUJBOE1LO0FBQ1Z0RixJQUFBQSxjQUFjLEdBQUcsQ0FBakI7QUFDQUMsSUFBQUEsV0FBVyxHQUFHLENBQWQ7QUFDRDtBQWpOTSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZ2xvYmFsID0gcmVxdWlyZSgnZ2xvYmFsJyk7XHJcblxyXG5sZXQgY2hhbmdlcG9zaXRpb24gPSAwIC8v55So5LqO6K6h566X5Zyo5pWw57uE5Lit55qE5L2N572uXHJcbmxldCBjaGFuZ2VhbmdsZSA9IDAgLy/nlKjkuo7orqHnrpfop5LluqZcclxuXHJcbmNjLkNsYXNzKHtcclxuICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcbiAgcHJvcGVydGllczoge1xyXG4gICAgY29sb3I6ICcnLFxyXG4gICAgY29sbGlkZXI6IHtcclxuICAgICAgZGVmYXVsdDogbnVsbCxcclxuICAgICAgdHlwZTogY2MuUG9seWdvbkNvbGxpZGVyXHJcbiAgICB9LFxyXG4gICAgYmxvY2t0eXBlOiAnJ1xyXG4gIH0sXHJcblxyXG4gIHN0YXJ0KCkge1xyXG4gICAgdGhpcy5fb2xkUG9zID0gdGhpcy5ub2RlLnBvc2l0aW9uO1xyXG4gICAgLy8gY29uc29sZS5sb2codGhpcy5fb2xkUG9zKVxyXG4gIH0sXHJcblxyXG4gIG9uTG9hZCgpIHtcclxuICAgIGNjLmRpcmVjdG9yLmdldENvbGxpc2lvbk1hbmFnZXIoKS5lbmFibGVkID0gdHJ1ZTtcclxuICAgIC8vIGNjLmRpcmVjdG9yLmdldENvbGxpc2lvbk1hbmFnZXIoKS5lbmFibGVkRGVidWdEcmF3ID0gdHJ1ZTtcclxuICAgIHRoaXMuaGl0ID0gZmFsc2U7XHJcblxyXG4gICAgLy8g6Kem5pG45LqL5Lu25byA5aeLXHJcbiAgICB0aGlzLm5vZGUub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfU1RBUlQsIGZ1bmN0aW9uICh0b3VjaCwgZXZlbnQpIHtcclxuICAgICAgdmFyIHRvdWNoTG9jID0gdG91Y2guZ2V0TG9jYXRpb24oKTtcclxuICAgICAgaWYgKGNjLkludGVyc2VjdGlvbi5wb2ludEluUG9seWdvbih0b3VjaExvYywgdGhpcy5jb2xsaWRlci53b3JsZC5wb2ludHMpKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5ub2RlLmJsb2NrdHlwZSk7XHJcbiAgICAgICAgdGhpcy5oaXQgPSB0cnVlO1xyXG4gICAgICAgIC8vIOWQr+eUqOe8k+WKqOWKqOeUu1xyXG4gICAgICAgIC8vIGNjLnR3ZWVuKHRoaXMubm9kZSkudG8oLjE1LCB7XHJcbiAgICAgICAgLy8gICBwb3NpdGlvbjogY2MudjIodG91Y2hMb2MueCAtIHRoaXMubm9kZS5wYXJlbnQud2lkdGggLyAyLCB0b3VjaExvYy55IC0gdGhpcy5ub2RlLnBhcmVudC5oZWlnaHQgLyAyKVxyXG4gICAgICAgIC8vIH0sIHtcclxuICAgICAgICAvLyAgIGVhc2luZzogJ3F1YWRJbidcclxuICAgICAgICAvLyB9KS5zdGFydCgpXHJcbiAgICAgICAgaWYgKHRoaXMuaGl0ICYmIHRoaXMubm9kZS5ibG9ja3R5cGUgPT0gJ3NtYWxsJykge1xyXG4gICAgICAgICAgdGhpcy5ub2RlLnggPSB0b3VjaExvYy54IC0gdGhpcy5ub2RlLnBhcmVudC53aWR0aCAvIDJcclxuICAgICAgICAgIHRoaXMubm9kZS55ID0gdG91Y2hMb2MueSAtIHRoaXMubm9kZS5wYXJlbnQuaGVpZ2h0IC8gMlxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSwgdGhpcyk7XHJcblxyXG4gICAgLy8g6Kem5pG45LqL5Lu255uR5ZCsXHJcbiAgICB0aGlzLm5vZGUub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfTU9WRSwgZnVuY3Rpb24gKHRvdWNoLCBldmVudCkge1xyXG4gICAgICB2YXIgdG91Y2hMb2MgPSB0b3VjaC5nZXRMb2NhdGlvbigpO1xyXG4gICAgICBpZiAodGhpcy5oaXQgJiYgdGhpcy5ub2RlLmJsb2NrdHlwZSA9PSAnc21hbGwnKSB7XHJcbiAgICAgICAgdGhpcy5ub2RlLnggKz0gdG91Y2guZ2V0RGVsdGEoKS54O1xyXG4gICAgICAgIHRoaXMubm9kZS55ICs9IHRvdWNoLmdldERlbHRhKCkueTtcclxuICAgICAgICB0b3VjaExvYy54ID0gdG91Y2hMb2MueCAtIHRoaXMubm9kZS5wYXJlbnQud2lkdGggLyAyXHJcbiAgICAgICAgdG91Y2hMb2MueSA9IHRvdWNoTG9jLnkgLSB0aGlzLm5vZGUucGFyZW50LmhlaWdodCAvIDJcclxuICAgICAgICBpZiAodG91Y2hMb2MueCA+IDAgJiYgdG91Y2hMb2MueSA+IDApIHtcclxuICAgICAgICAgIHRoaXMubm9kZS5hbmdsZSA9IE1hdGguYXRhbih0b3VjaExvYy55IC8gdG91Y2hMb2MueCkgLyBNYXRoLlBJICogMTgwICsgOTAgLSAyMi41XHJcbiAgICAgICAgfSBlbHNlIGlmICh0b3VjaExvYy54IDwgMCAmJiB0b3VjaExvYy55ID4gMCkge1xyXG4gICAgICAgICAgdGhpcy5ub2RlLmFuZ2xlID0gTWF0aC5hdGFuKC10b3VjaExvYy54IC8gdG91Y2hMb2MueSkgLyBNYXRoLlBJICogMTgwICsgMTgwIC0gMjIuNVxyXG4gICAgICAgIH0gZWxzZSBpZiAodG91Y2hMb2MueCA8IDAgJiYgdG91Y2hMb2MueSA8IDApIHtcclxuICAgICAgICAgIHRoaXMubm9kZS5hbmdsZSA9IE1hdGguYXRhbigtdG91Y2hMb2MueSAvIC10b3VjaExvYy54KSAvIE1hdGguUEkgKiAxODAgKyAyNzAgLSAyMi41XHJcbiAgICAgICAgfSBlbHNlIGlmICh0b3VjaExvYy54ID4gMCAmJiB0b3VjaExvYy55IDwgMCkge1xyXG4gICAgICAgICAgdGhpcy5ub2RlLmFuZ2xlID0gTWF0aC5hdGFuKHRvdWNoTG9jLnggLyAtdG91Y2hMb2MueSkgLyBNYXRoLlBJICogMTgwIC0gMjIuNVxyXG4gICAgICAgIH0gZWxzZSBpZiAodG91Y2hMb2MueCA9PSAwICYmIHRvdWNoTG9jLnkgPiAwKSB7XHJcbiAgICAgICAgICB0aGlzLm5vZGUuYW5nbGUgPSAxODAgLSAyMi41XHJcbiAgICAgICAgfSBlbHNlIGlmICh0b3VjaExvYy54ID09IDAgJiYgdG91Y2hMb2MueSA8IDApIHtcclxuICAgICAgICAgIHRoaXMubm9kZS5hbmdsZSA9IDAgLSAyMi41XHJcbiAgICAgICAgfSBlbHNlIGlmICh0b3VjaExvYy54ID4gMCAmJiB0b3VjaExvYy55ID09IDApIHtcclxuICAgICAgICAgIHRoaXMubm9kZS5hbmdsZSA9IDkwIC0gMjIuNVxyXG4gICAgICAgIH0gZWxzZSBpZiAodG91Y2hMb2MueCA8IDAgJiYgdG91Y2hMb2MueSA9PSAwKSB7XHJcbiAgICAgICAgICB0aGlzLm5vZGUuYW5nbGUgPSAyNzAgLSAyMi41XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9LCB0aGlzKTtcclxuXHJcbiAgICAvLyDop6bmkbjkuovku7bnu5PmnZ9cclxuICAgIHRoaXMubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9FTkQsIGZ1bmN0aW9uICh0b3VjaCwgZXZlbnQpIHtcclxuICAgICAgaWYgKHRoaXMuaGl0ICYmIHRoaXMubm9kZS5ibG9ja3R5cGUgPT0gJ3NtYWxsJykge1xyXG4gICAgICAgIHRoaXMuaGl0ID0gZmFsc2U7XHJcbiAgICAgICAgLy8g6K6w5b2V5b2T5YmN5pS+572u55qE5L2N572uXHJcbiAgICAgICAgbGV0IGN1cnJlbnRpbmRleCA9IC0xO1xyXG4gICAgICAgIGNvbnN0IHBvaW50cyA9IGdsb2JhbC5pbnNpZGVwb2ludHNcclxuXHJcbiAgICAgICAgLy8g5rKh5pyJ56e75Yqo5Yiw5ZyG546v55uu5qCH5L2N572u5Yy65Z+f77yM56e75Yqo5Yiw5Yid5aeL5L2N572uXHJcbiAgICAgICAgaWYgKHRoaXMubm9kZS54ICogdGhpcy5ub2RlLnggKyB0aGlzLm5vZGUueSAqIHRoaXMubm9kZS55ID4gNDc0ICogNDc0IC8gNCkge1xyXG4gICAgICAgICAgaWYgKHRvdWNoLmdldExvY2F0aW9uKCkueCAtIHRoaXMubm9kZS5wYXJlbnQud2lkdGggLyAyIDwgMClcclxuICAgICAgICAgICAgdGhpcy5lYXNlVG8odGhpcy5fb2xkUG9zLngsIHRoaXMuX29sZFBvcy55LCAzMzcuNSwgLjIpXHJcbiAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHRoaXMuZWFzZVRvKHRoaXMuX29sZFBvcy54LCB0aGlzLl9vbGRQb3MueSwgLTIyLjUsIC4yKVxyXG4gICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgLy8g56e75Yqo5Yiw5LqG5ZyG546v55uu5qCH5L2N572u5Yy65Z+fXHJcbiAgICAgICAgICBpZiAodGhpcy5ub2RlLnggPiAwICYmIHRoaXMubm9kZS55IDwgMCkgY3VycmVudGluZGV4ID0gdGhpcy5ub2RlLnggPCAtdGhpcy5ub2RlLnkgPyAwIDogMVxyXG4gICAgICAgICAgaWYgKHRoaXMubm9kZS54ID4gMCAmJiB0aGlzLm5vZGUueSA+IDApIGN1cnJlbnRpbmRleCA9IHRoaXMubm9kZS54ID4gdGhpcy5ub2RlLnkgPyAyIDogM1xyXG4gICAgICAgICAgaWYgKHRoaXMubm9kZS54IDwgMCAmJiB0aGlzLm5vZGUueSA+IDApIGN1cnJlbnRpbmRleCA9IC10aGlzLm5vZGUueCA8IHRoaXMubm9kZS55ID8gNCA6IDVcclxuICAgICAgICAgIGlmICh0aGlzLm5vZGUueCA8IDAgJiYgdGhpcy5ub2RlLnkgPCAwKSBjdXJyZW50aW5kZXggPSAtdGhpcy5ub2RlLnggPiAtdGhpcy5ub2RlLnkgPyA2IDogN1xyXG5cclxuICAgICAgICAgIC8vIOagh+iusOW9k+WJjeS9jee9ruaYr+WQpuS4uuepulxyXG4gICAgICAgICAgbGV0IGlzZW1wdHkgPSB0cnVlXHJcblxyXG4gICAgICAgICAgLy8g5Zyo5a+55bqU5ZyG546v5bey5pS+572u55qE5pWw57uE5Lit5p+l5om+XHJcbiAgICAgICAgICBnbG9iYWwuaW5zaWRlYmxvY2tzLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmluZGV4ID09IGN1cnJlbnRpbmRleCkgaXNlbXB0eSA9IGZhbHNlIC8vIOaJvuWIsOivtOaYjuW9k+WJjeS9jee9ruS4jeWPr+eUqFxyXG4gICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAvLyDlvZPliY3kvY3nva7oi6XkuLrnqbpcclxuICAgICAgICAgIGlmIChpc2VtcHR5ICYmIHRoaXMubm9kZS54ICE9IDAgJiYgdGhpcy5ub2RlLnkgIT0gMCkge1xyXG5cclxuICAgICAgICAgICAgLy/orqHnrpfml4vovazop5LluqZcclxuICAgICAgICAgICAgZ2xvYmFsLlNjaGFuZ2VhbmdsZSArPSA0NSAqIHBhcnNlSW50KHRoaXMuZ2FtZS5yb3RhdGVHcmlkc1Muc3RyaW5nKVxyXG5cclxuICAgICAgICAgICAgLy/orqHnrpflnZfnmoTnnJ/mraPkvY3nva5cclxuICAgICAgICAgICAgbGV0IG4gPSAoY3VycmVudGluZGV4ICsgZ2xvYmFsLlNjaGFuZ2Vwb3NpdGlvbikgJSA4XHJcbiAgICAgICAgICAgIGlmIChuIDwgMClcclxuICAgICAgICAgICAgICBuICs9IDhcclxuXHJcbiAgICAgICAgICAgIC8v5pS+572u5Z2X55qE57yT5Yqo5pWI5p6cXHJcbiAgICAgICAgICAgIGNjLnR3ZWVuKHRoaXMubm9kZSkudG8oLjIsIHtcclxuICAgICAgICAgICAgICB4OiBwb2ludHNbY3VycmVudGluZGV4XS54LFxyXG4gICAgICAgICAgICAgIHk6IHBvaW50c1tjdXJyZW50aW5kZXhdLnksXHJcbiAgICAgICAgICAgICAgYW5nbGU6IHBvaW50c1tjdXJyZW50aW5kZXhdLmEsXHJcbiAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICBlYXNpbmc6ICdxdWFkSW4nXHJcbiAgICAgICAgICAgIH0pLmNhbGwoKCkgPT4ge1xyXG4gICAgICAgICAgICAgIC8v5pS+572u5Z2XXHJcbiAgICAgICAgICAgICAgdGhpcy5ub2RlLnggPSBwb2ludHNbbl0ueFxyXG4gICAgICAgICAgICAgIHRoaXMubm9kZS55ID0gcG9pbnRzW25dLnlcclxuICAgICAgICAgICAgICB0aGlzLm5vZGUuYW5nbGUgPSBwb2ludHNbbl0uYVxyXG5cclxuICAgICAgICAgICAgICAvL+abtOaUueWdl+eahOeItuiKgueCuVxyXG4gICAgICAgICAgICAgIHRoaXMubm9kZS5yZW1vdmVGcm9tUGFyZW50KGZhbHNlKTtcclxuICAgICAgICAgICAgICB0aGlzLmdhbWUuaW5zaWRlLmFkZENoaWxkKHRoaXMubm9kZSk7XHJcblxyXG4gICAgICAgICAgICAgIC8v546v5peL6L2s55qE57yT5Yqo5pWI5p6cXHJcbiAgICAgICAgICAgICAgY2MudHdlZW4odGhpcy5nYW1lLmluc2lkZSkudG8oTWF0aC5hYnMocGFyc2VJbnQodGhpcy5nYW1lLnJvdGF0ZUdyaWRzUy5zdHJpbmcpKSAvIDQsIHtcclxuICAgICAgICAgICAgICAgIGFuZ2xlOiBnbG9iYWwuU2NoYW5nZWFuZ2xlXHJcbiAgICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgZWFzaW5nOiAncXVhZEluJ1xyXG4gICAgICAgICAgICAgIH0pLmNhbGwoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lLmRlbGV0ZUJsb2NrKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8g5pKt5pS+6Z+z5pWIXHJcbiAgICAgICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5wbGF5RWZmZWN0KHRoaXMuZ2FtZS5yb3RhdGVBdWRpbywgZmFsc2UpO1xyXG4gICAgICAgICAgICAgIH0pLnN0YXJ0KClcclxuICAgICAgICAgICAgfSkuc3RhcnQoKVxyXG5cclxuICAgICAgICAgICAgLy8g5p6E6YCg5b2T5YmN5Z2X55qE5a+56LGh77yM55So5LqO5L+d5a2Y5Zyo5ZyG546v5a+56LGh5pWw57uE5LitXHJcbiAgICAgICAgICAgIGxldCBibG9jayA9IHtcclxuICAgICAgICAgICAgICBpbmRleDogY3VycmVudGluZGV4LCAvLyDlnZfnmoTkvY3nva7luo/lj7dcclxuICAgICAgICAgICAgICBjb2xvcjogdGhpcy5ub2RlLmNvbG9yLl92YWwsIC8vIOWdl+eahOminOiJslxyXG4gICAgICAgICAgICAgIHJvdGF0ZUdyaWRzUzogdGhpcy5nYW1lLnJvdGF0ZUdyaWRzUy5zdHJpbmcsIC8vIOWdl+eahOi9rOWKqOagvOaVsFxyXG4gICAgICAgICAgICAgIGJsb2NraXRlbTogdGhpc1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyDkv53lrZjlnKjlnIbnjq/lr7nosaHmlbDnu4TkuK1cclxuICAgICAgICAgICAgZ2xvYmFsLmluc2lkZWJsb2Nrcy5wdXNoKGJsb2NrKVxyXG5cclxuICAgICAgICAgICAgLy8g5pKt5pS+6Z+z5pWIXHJcbiAgICAgICAgICAgIGNjLmF1ZGlvRW5naW5lLnBsYXlFZmZlY3QodGhpcy5nYW1lLnBsYWNlQXVkaW8sIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8v6K6h566X5Zyo5pWw57uE5Lit55qE5L2N572uXHJcbiAgICAgICAgICAgIGdsb2JhbC5TY2hhbmdlcG9zaXRpb24gLT0gcGFyc2VJbnQodGhpcy5nYW1lLnJvdGF0ZUdyaWRzUy5zdHJpbmcpXHJcblxyXG4gICAgICAgICAgICAvL+abtOaWsOaVsOe7hOS4reaJgOacieWdl+eahOS9jee9rlxyXG4gICAgICAgICAgICBnbG9iYWwuaW5zaWRlYmxvY2tzLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgaXRlbS5pbmRleCA9IChpdGVtLmluZGV4ICsgcGFyc2VJbnQodGhpcy5nYW1lLnJvdGF0ZUdyaWRzUy5zdHJpbmcpKSAlIDhcclxuICAgICAgICAgICAgICBpZiAoaXRlbS5pbmRleCA8IDApXHJcbiAgICAgICAgICAgICAgICBpdGVtLmluZGV4ICs9IDhcclxuICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJnbG9iYWwuaW5zaWRlYmxvY2tzOiBcIilcclxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhnbG9iYWwuaW5zaWRlYmxvY2tzKVxyXG5cclxuICAgICAgICAgICAgLy8g5bCG5b2T5YmN5Z2X6K6+572u5Li65LiN5Y+v54K55Ye7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5ibG9ja3R5cGUgPSAnaW5zaWRlJ1xyXG5cclxuICAgICAgICAgICAgLy8g5pS+572u5qyh5pWw5YqgMVxyXG4gICAgICAgICAgICBnbG9iYWwuY291bnQrK1xyXG5cclxuICAgICAgICAgICAgLy8g5aaC5p6c5LiJ5Liq5Z2X5Z2H5bey5pS+572u5a6M5q+V77yM5YiZ6YeN5paw55Sf5oiQ5LiJ5Liq5Z2XXHJcbiAgICAgICAgICAgIGlmIChnbG9iYWwuY291bnQgIT0gMCAmJiBnbG9iYWwuY291bnQgJSAzID09IDApIHtcclxuICAgICAgICAgICAgICB0aGlzLmdhbWUuc3Bhd25CbG9jaygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyDlvZPliY3kvY3nva7oi6XkuI3kuLrnqbrvvIznp7vliqjliLDliJ3lp4vkvY3nva5cclxuICAgICAgICAgICAgaWYgKHRvdWNoLmdldExvY2F0aW9uKCkueCAtIHRoaXMubm9kZS5wYXJlbnQud2lkdGggLyAyIDwgMClcclxuICAgICAgICAgICAgICB0aGlzLmVhc2VUbyh0aGlzLl9vbGRQb3MueCwgdGhpcy5fb2xkUG9zLnksIDMzNy41LCAuMilcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgIHRoaXMuZWFzZVRvKHRoaXMuX29sZFBvcy54LCB0aGlzLl9vbGRQb3MueSwgLTIyLjUsIC4yKVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSwgdGhpcyk7XHJcbiAgfSxcclxuXHJcbiAgLy8g57yT5Yqo5Ye95pWwXHJcbiAgZWFzZVRvOiBmdW5jdGlvbiAoeCwgeSwgYSwgdCkge1xyXG4gICAgY2MudHdlZW4odGhpcy5ub2RlKS50byh0LCB7XHJcbiAgICAgIHBvc2l0aW9uOiBjYy52Mih4LCB5KSxcclxuICAgICAgYW5nbGU6IGFcclxuICAgIH0sIHtcclxuICAgICAgZWFzaW5nOiAncXVhZEluJ1xyXG4gICAgfSkuc3RhcnQoKVxyXG4gIH0sXHJcblxyXG4gIG9uRGlzYWJsZSgpIHtcclxuICAgIGNjLmRpcmVjdG9yLmdldENvbGxpc2lvbk1hbmFnZXIoKS5lbmFibGVkID0gZmFsc2U7XHJcbiAgICBjYy5kaXJlY3Rvci5nZXRDb2xsaXNpb25NYW5hZ2VyKCkuZW5hYmxlZERlYnVnRHJhdyA9IGZhbHNlO1xyXG4gICAgdGhpcy5ub2RlLm9mZihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9TVEFSVCk7XHJcbiAgICB0aGlzLm5vZGUub2ZmKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX01PVkUpO1xyXG4gICAgdGhpcy5ub2RlLm9mZihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9FTkQpO1xyXG4gIH0sXHJcblxyXG4gIG9uRGVzdHJveSgpIHtcclxuICAgIGNoYW5nZXBvc2l0aW9uID0gMFxyXG4gICAgY2hhbmdlYW5nbGUgPSAwXHJcbiAgfVxyXG59KTtcclxuIl19