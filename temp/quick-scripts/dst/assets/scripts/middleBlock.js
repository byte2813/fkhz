
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/middleBlock.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'a53709PMr5OnZS+CYNpn/Ws', 'middleBlock');
// scripts/middleBlock.js

"use strict";

var global = require('global');

cc.Class({
  "extends": cc.Component,
  properties: {
    color: '',
    collider: {
      "default": null,
      type: cc.PolygonCollider
    },
    blocktype: ''
  },
  start: function start() {
    this._oldPos = this.node.position; // console.log(this._oldPos)
  },
  onLoad: function onLoad() {
    cc.director.getCollisionManager().enabled = true;
    this.hit = false; // 触摸事件开始

    this.node.on(cc.Node.EventType.TOUCH_START, function (touch, event) {
      var touchLoc = touch.getLocation();

      if (cc.Intersection.pointInPolygon(touchLoc, this.collider.world.points)) {
        console.log(this.node.blocktype);
        this.hit = true; // 启用缓动动画
        // cc.tween(this.node).to(.15, {
        //   position: cc.v2(touchLoc.x - this.node.parent.width / 2, touchLoc.y - this.node.parent.height / 2)
        // }, {
        //   easing: 'quadIn'
        // }).start()

        if (this.hit && this.node.blocktype == 'middle') {
          this.node.x = touchLoc.x - this.node.parent.width / 2;
          this.node.y = touchLoc.y - this.node.parent.height / 2;
        }
      }
    }, this); // 触摸事件监听

    this.node.on(cc.Node.EventType.TOUCH_MOVE, function (touch, event) {
      var touchLoc = touch.getLocation();

      if (this.hit && this.node.blocktype == 'middle') {
        this.node.x += touch.getDelta().x;
        this.node.y += touch.getDelta().y;
        touchLoc.x = touchLoc.x - this.node.parent.width / 2;
        touchLoc.y = touchLoc.y - this.node.parent.height / 2;

        if (touchLoc.x > 0 && touchLoc.y > 0) {
          this.node.angle = Math.atan(touchLoc.y / touchLoc.x) / Math.PI * 180 + 90 - 22.5;
        } else if (touchLoc.x < 0 && touchLoc.y > 0) {
          this.node.angle = Math.atan(-touchLoc.x / touchLoc.y) / Math.PI * 180 + 180 - 22.5;
        } else if (touchLoc.x < 0 && touchLoc.y < 0) {
          this.node.angle = Math.atan(-touchLoc.y / -touchLoc.x) / Math.PI * 180 + 270 - 22.5;
        } else if (touchLoc.x > 0 && touchLoc.y < 0) {
          this.node.angle = Math.atan(touchLoc.x / -touchLoc.y) / Math.PI * 180 - 22.5;
        } else if (touchLoc.x == 0 && touchLoc.y > 0) {
          this.node.angle = 180 - 22.5;
        } else if (touchLoc.x == 0 && touchLoc.y < 0) {
          this.node.angle = 0 - 22.5;
        } else if (touchLoc.x > 0 && touchLoc.y == 0) {
          this.node.angle = 90 - 22.5;
        } else if (touchLoc.x < 0 && touchLoc.y == 0) {
          this.node.angle = 270 - 22.5;
        }
      }
    }, this); // 触摸事件结束

    this.node.on(cc.Node.EventType.TOUCH_END, function (touch, event) {
      var _this = this;

      if (this.hit && this.node.blocktype == 'middle') {
        this.hit = false; // 记录当前放置的位置

        var currentindex = -1;
        var points = global.besidepoints; // 没有移动到圆环目标位置区域，移动到初始位置

        if (this.node.x * this.node.x + this.node.y * this.node.y > 774 * 774 / 4 || this.node.x * this.node.x + this.node.y * this.node.y < 274 * 274 / 4) {
          if (touch.getLocation().x - this.node.parent.width / 2 < 0) this.easeTo(this._oldPos.x, this._oldPos.y, 337.5, .2);else this.easeTo(this._oldPos.x, this._oldPos.y, -22.5, .2);
        } else {
          // 移动到了圆环目标位置区域
          if (this.node.x > 0 && this.node.y < 0) currentindex = this.node.x < -this.node.y ? 0 : 1;
          if (this.node.x > 0 && this.node.y > 0) currentindex = this.node.x > this.node.y ? 2 : 3;
          if (this.node.x < 0 && this.node.y > 0) currentindex = -this.node.x < this.node.y ? 4 : 5;
          if (this.node.x < 0 && this.node.y < 0) currentindex = -this.node.x > -this.node.y ? 6 : 7; // 标记当前位置是否为空

          var isempty = true; // 在对应圆环已放置的数组中查找

          global.besideblocks.forEach(function (item) {
            if (item.index == currentindex) isempty = false; // 找到说明当前位置不可用
          }); // 当前位置若为空

          if (isempty && this.node.x != 0 && this.node.y != 0) {
            //计算旋转角度
            global.Mchangeangle += 45 * parseInt(this.game.rotateGridsM.string); //计算块的真正位置

            var n = (currentindex + global.Mchangeposition) % 8;
            if (n < 0) n += 8; //放置块的缓动效果

            cc.tween(this.node).to(.2, {
              x: points[currentindex].x,
              y: points[currentindex].y,
              angle: points[currentindex].a
            }, {
              easing: 'quadIn'
            }).call(function () {
              //放置块
              _this.node.x = points[n].x;
              _this.node.y = points[n].y;
              _this.node.angle = points[n].a; //更改块的父节点

              _this.node.removeFromParent(false);

              _this.game.beside.addChild(_this.node); //环旋转的缓动效果


              cc.tween(_this.game.beside).to(Math.abs(parseInt(_this.game.rotateGridsM.string)) / 4, {
                angle: global.Mchangeangle
              }, {
                easing: 'quadIn'
              }).call(function () {
                _this.game.deleteBlock(); // 播放音效


                cc.audioEngine.playEffect(_this.game.rotateAudio, false);
              }).start();
            }).start(); // 构造当前块的对象，用于保存在圆环对象数组中

            var block = {
              index: currentindex,
              // 块的位置序号
              color: this.node.color._val,
              // 块的颜色
              rotateGridsM: this.game.rotateGridsM.string,
              // 块的转动格数
              blockitem: this
            }; // 保存在圆环对象数组中

            global.besideblocks.push(block); // 播放音效

            cc.audioEngine.playEffect(this.game.placeAudio, false); //计算在数组中的位置

            global.Mchangeposition -= parseInt(this.game.rotateGridsM.string); //更新数组中所有块的位置

            global.besideblocks.forEach(function (item) {
              item.index = (item.index + parseInt(_this.game.rotateGridsM.string)) % 8;
              if (item.index < 0) item.index += 8;
            }); //console.log("global.besideblocks: ")
            //console.log(global.besideblocks)
            // 将当前块设置为不可点击

            this.node.blocktype = 'beside'; // 放置次数加1

            global.count++; // 如果三个块均已放置完毕，则重新生成三个块

            if (global.count != 0 && global.count % 3 == 0) {
              this.game.spawnBlock();
            }
          } else {
            // 当前位置若不为空，移动到初始位置
            if (touch.getLocation().x - this.node.parent.width / 2 < 0) this.easeTo(this._oldPos.x, this._oldPos.y, 337.5, .2);else this.easeTo(this._oldPos.x, this._oldPos.y, -22.5, .2);
          }
        }
      }
    }, this);
  },
  // 缓动函数
  easeTo: function easeTo(x, y, a, t) {
    cc.tween(this.node).to(t, {
      position: cc.v2(x, y),
      angle: a
    }, {
      easing: 'quadIn'
    }).start();
  },
  onDisable: function onDisable() {
    cc.director.getCollisionManager().enabled = false;
    cc.director.getCollisionManager().enabledDebugDraw = false;
    this.node.off(cc.Node.EventType.TOUCH_START);
    this.node.off(cc.Node.EventType.TOUCH_MOVE);
    this.node.off(cc.Node.EventType.TOUCH_END);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcbWlkZGxlQmxvY2suanMiXSwibmFtZXMiOlsiZ2xvYmFsIiwicmVxdWlyZSIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwiY29sb3IiLCJjb2xsaWRlciIsInR5cGUiLCJQb2x5Z29uQ29sbGlkZXIiLCJibG9ja3R5cGUiLCJzdGFydCIsIl9vbGRQb3MiLCJub2RlIiwicG9zaXRpb24iLCJvbkxvYWQiLCJkaXJlY3RvciIsImdldENvbGxpc2lvbk1hbmFnZXIiLCJlbmFibGVkIiwiaGl0Iiwib24iLCJOb2RlIiwiRXZlbnRUeXBlIiwiVE9VQ0hfU1RBUlQiLCJ0b3VjaCIsImV2ZW50IiwidG91Y2hMb2MiLCJnZXRMb2NhdGlvbiIsIkludGVyc2VjdGlvbiIsInBvaW50SW5Qb2x5Z29uIiwid29ybGQiLCJwb2ludHMiLCJjb25zb2xlIiwibG9nIiwieCIsInBhcmVudCIsIndpZHRoIiwieSIsImhlaWdodCIsIlRPVUNIX01PVkUiLCJnZXREZWx0YSIsImFuZ2xlIiwiTWF0aCIsImF0YW4iLCJQSSIsIlRPVUNIX0VORCIsImN1cnJlbnRpbmRleCIsImJlc2lkZXBvaW50cyIsImVhc2VUbyIsImlzZW1wdHkiLCJiZXNpZGVibG9ja3MiLCJmb3JFYWNoIiwiaXRlbSIsImluZGV4IiwiTWNoYW5nZWFuZ2xlIiwicGFyc2VJbnQiLCJnYW1lIiwicm90YXRlR3JpZHNNIiwic3RyaW5nIiwibiIsIk1jaGFuZ2Vwb3NpdGlvbiIsInR3ZWVuIiwidG8iLCJhIiwiZWFzaW5nIiwiY2FsbCIsInJlbW92ZUZyb21QYXJlbnQiLCJiZXNpZGUiLCJhZGRDaGlsZCIsImFicyIsImRlbGV0ZUJsb2NrIiwiYXVkaW9FbmdpbmUiLCJwbGF5RWZmZWN0Iiwicm90YXRlQXVkaW8iLCJibG9jayIsIl92YWwiLCJibG9ja2l0ZW0iLCJwdXNoIiwicGxhY2VBdWRpbyIsImNvdW50Iiwic3Bhd25CbG9jayIsInQiLCJ2MiIsIm9uRGlz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O0FBL01NLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBnbG9iYWwgPSByZXF1aXJlKCdnbG9iYWwnKTtcclxuXHJcbmNjLkNsYXNzKHtcclxuICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcbiAgcHJvcGVydGllczoge1xyXG4gICAgY29sb3I6ICcnLFxyXG4gICAgY29sbGlkZXI6IHtcclxuICAgICAgZGVmYXVsdDogbnVsbCxcclxuICAgICAgdHlwZTogY2MuUG9seWdvbkNvbGxpZGVyXHJcbiAgICB9LFxyXG4gICAgYmxvY2t0eXBlOiAnJ1xyXG4gIH0sXHJcblxyXG4gIHN0YXJ0KCkge1xyXG4gICAgdGhpcy5fb2xkUG9zID0gdGhpcy5ub2RlLnBvc2l0aW9uO1xyXG4gICAgLy8gY29uc29sZS5sb2codGhpcy5fb2xkUG9zKVxyXG4gIH0sXHJcblxyXG4gIG9uTG9hZCgpIHtcclxuICAgIGNjLmRpcmVjdG9yLmdldENvbGxpc2lvbk1hbmFnZXIoKS5lbmFibGVkID0gdHJ1ZTtcclxuICAgIHRoaXMuaGl0ID0gZmFsc2U7XHJcblxyXG4gICAgLy8g6Kem5pG45LqL5Lu25byA5aeLXHJcbiAgICB0aGlzLm5vZGUub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfU1RBUlQsIGZ1bmN0aW9uICh0b3VjaCwgZXZlbnQpIHtcclxuICAgICAgdmFyIHRvdWNoTG9jID0gdG91Y2guZ2V0TG9jYXRpb24oKTtcclxuICAgICAgaWYgKGNjLkludGVyc2VjdGlvbi5wb2ludEluUG9seWdvbih0b3VjaExvYywgdGhpcy5jb2xsaWRlci53b3JsZC5wb2ludHMpKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5ub2RlLmJsb2NrdHlwZSk7XHJcbiAgICAgICAgdGhpcy5oaXQgPSB0cnVlO1xyXG4gICAgICAgIC8vIOWQr+eUqOe8k+WKqOWKqOeUu1xyXG4gICAgICAgIC8vIGNjLnR3ZWVuKHRoaXMubm9kZSkudG8oLjE1LCB7XHJcbiAgICAgICAgLy8gICBwb3NpdGlvbjogY2MudjIodG91Y2hMb2MueCAtIHRoaXMubm9kZS5wYXJlbnQud2lkdGggLyAyLCB0b3VjaExvYy55IC0gdGhpcy5ub2RlLnBhcmVudC5oZWlnaHQgLyAyKVxyXG4gICAgICAgIC8vIH0sIHtcclxuICAgICAgICAvLyAgIGVhc2luZzogJ3F1YWRJbidcclxuICAgICAgICAvLyB9KS5zdGFydCgpXHJcbiAgICAgICAgaWYgKHRoaXMuaGl0ICYmIHRoaXMubm9kZS5ibG9ja3R5cGUgPT0gJ21pZGRsZScpIHtcclxuICAgICAgICAgIHRoaXMubm9kZS54ID0gdG91Y2hMb2MueCAtIHRoaXMubm9kZS5wYXJlbnQud2lkdGggLyAyXHJcbiAgICAgICAgICB0aGlzLm5vZGUueSA9IHRvdWNoTG9jLnkgLSB0aGlzLm5vZGUucGFyZW50LmhlaWdodCAvIDJcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0sIHRoaXMpO1xyXG5cclxuICAgIC8vIOinpuaRuOS6i+S7tuebkeWQrFxyXG4gICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX01PVkUsIGZ1bmN0aW9uICh0b3VjaCwgZXZlbnQpIHtcclxuICAgICAgdmFyIHRvdWNoTG9jID0gdG91Y2guZ2V0TG9jYXRpb24oKTtcclxuICAgICAgaWYgKHRoaXMuaGl0ICYmIHRoaXMubm9kZS5ibG9ja3R5cGUgPT0gJ21pZGRsZScpIHtcclxuICAgICAgICB0aGlzLm5vZGUueCArPSB0b3VjaC5nZXREZWx0YSgpLng7XHJcbiAgICAgICAgdGhpcy5ub2RlLnkgKz0gdG91Y2guZ2V0RGVsdGEoKS55O1xyXG4gICAgICAgIHRvdWNoTG9jLnggPSB0b3VjaExvYy54IC0gdGhpcy5ub2RlLnBhcmVudC53aWR0aCAvIDJcclxuICAgICAgICB0b3VjaExvYy55ID0gdG91Y2hMb2MueSAtIHRoaXMubm9kZS5wYXJlbnQuaGVpZ2h0IC8gMlxyXG4gICAgICAgIGlmICh0b3VjaExvYy54ID4gMCAmJiB0b3VjaExvYy55ID4gMCkge1xyXG4gICAgICAgICAgdGhpcy5ub2RlLmFuZ2xlID0gTWF0aC5hdGFuKHRvdWNoTG9jLnkgLyB0b3VjaExvYy54KSAvIE1hdGguUEkgKiAxODAgKyA5MCAtIDIyLjVcclxuICAgICAgICB9IGVsc2UgaWYgKHRvdWNoTG9jLnggPCAwICYmIHRvdWNoTG9jLnkgPiAwKSB7XHJcbiAgICAgICAgICB0aGlzLm5vZGUuYW5nbGUgPSBNYXRoLmF0YW4oLXRvdWNoTG9jLnggLyB0b3VjaExvYy55KSAvIE1hdGguUEkgKiAxODAgKyAxODAgLSAyMi41XHJcbiAgICAgICAgfSBlbHNlIGlmICh0b3VjaExvYy54IDwgMCAmJiB0b3VjaExvYy55IDwgMCkge1xyXG4gICAgICAgICAgdGhpcy5ub2RlLmFuZ2xlID0gTWF0aC5hdGFuKC10b3VjaExvYy55IC8gLXRvdWNoTG9jLngpIC8gTWF0aC5QSSAqIDE4MCArIDI3MCAtIDIyLjVcclxuICAgICAgICB9IGVsc2UgaWYgKHRvdWNoTG9jLnggPiAwICYmIHRvdWNoTG9jLnkgPCAwKSB7XHJcbiAgICAgICAgICB0aGlzLm5vZGUuYW5nbGUgPSBNYXRoLmF0YW4odG91Y2hMb2MueCAvIC10b3VjaExvYy55KSAvIE1hdGguUEkgKiAxODAgLSAyMi41XHJcbiAgICAgICAgfSBlbHNlIGlmICh0b3VjaExvYy54ID09IDAgJiYgdG91Y2hMb2MueSA+IDApIHtcclxuICAgICAgICAgIHRoaXMubm9kZS5hbmdsZSA9IDE4MCAtIDIyLjVcclxuICAgICAgICB9IGVsc2UgaWYgKHRvdWNoTG9jLnggPT0gMCAmJiB0b3VjaExvYy55IDwgMCkge1xyXG4gICAgICAgICAgdGhpcy5ub2RlLmFuZ2xlID0gMCAtIDIyLjVcclxuICAgICAgICB9IGVsc2UgaWYgKHRvdWNoTG9jLnggPiAwICYmIHRvdWNoTG9jLnkgPT0gMCkge1xyXG4gICAgICAgICAgdGhpcy5ub2RlLmFuZ2xlID0gOTAgLSAyMi41XHJcbiAgICAgICAgfSBlbHNlIGlmICh0b3VjaExvYy54IDwgMCAmJiB0b3VjaExvYy55ID09IDApIHtcclxuICAgICAgICAgIHRoaXMubm9kZS5hbmdsZSA9IDI3MCAtIDIyLjVcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0sIHRoaXMpO1xyXG5cclxuICAgIC8vIOinpuaRuOS6i+S7tue7k+adn1xyXG4gICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0VORCwgZnVuY3Rpb24gKHRvdWNoLCBldmVudCkge1xyXG4gICAgICBpZiAodGhpcy5oaXQgJiYgdGhpcy5ub2RlLmJsb2NrdHlwZSA9PSAnbWlkZGxlJykge1xyXG4gICAgICAgIHRoaXMuaGl0ID0gZmFsc2U7XHJcblxyXG4gICAgICAgIC8vIOiusOW9leW9k+WJjeaUvue9rueahOS9jee9rlxyXG4gICAgICAgIGxldCBjdXJyZW50aW5kZXggPSAtMTtcclxuICAgICAgICBjb25zdCBwb2ludHMgPSBnbG9iYWwuYmVzaWRlcG9pbnRzXHJcblxyXG4gICAgICAgIC8vIOayoeacieenu+WKqOWIsOWchueOr+ebruagh+S9jee9ruWMuuWfn++8jOenu+WKqOWIsOWIneWni+S9jee9rlxyXG4gICAgICAgIGlmICh0aGlzLm5vZGUueCAqIHRoaXMubm9kZS54ICsgdGhpcy5ub2RlLnkgKiB0aGlzLm5vZGUueSA+IDc3NCAqIDc3NCAvIDQgfHwgdGhpcy5ub2RlLnggKiB0aGlzLm5vZGUueCArXHJcbiAgICAgICAgICB0aGlzLm5vZGUueSAqIHRoaXMubm9kZS55IDwgMjc0ICogMjc0IC8gNCkge1xyXG5cclxuICAgICAgICAgIGlmICh0b3VjaC5nZXRMb2NhdGlvbigpLnggLSB0aGlzLm5vZGUucGFyZW50LndpZHRoIC8gMiA8IDApXHJcbiAgICAgICAgICAgIHRoaXMuZWFzZVRvKHRoaXMuX29sZFBvcy54LCB0aGlzLl9vbGRQb3MueSwgMzM3LjUsIC4yKVxyXG4gICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB0aGlzLmVhc2VUbyh0aGlzLl9vbGRQb3MueCwgdGhpcy5fb2xkUG9zLnksIC0yMi41LCAuMilcclxuICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgIC8vIOenu+WKqOWIsOS6huWchueOr+ebruagh+S9jee9ruWMuuWfn1xyXG4gICAgICAgICAgaWYgKHRoaXMubm9kZS54ID4gMCAmJiB0aGlzLm5vZGUueSA8IDApIGN1cnJlbnRpbmRleCA9IHRoaXMubm9kZS54IDwgLXRoaXMubm9kZS55ID8gMCA6IDFcclxuICAgICAgICAgIGlmICh0aGlzLm5vZGUueCA+IDAgJiYgdGhpcy5ub2RlLnkgPiAwKSBjdXJyZW50aW5kZXggPSB0aGlzLm5vZGUueCA+IHRoaXMubm9kZS55ID8gMiA6IDNcclxuICAgICAgICAgIGlmICh0aGlzLm5vZGUueCA8IDAgJiYgdGhpcy5ub2RlLnkgPiAwKSBjdXJyZW50aW5kZXggPSAtdGhpcy5ub2RlLnggPCB0aGlzLm5vZGUueSA/IDQgOiA1XHJcbiAgICAgICAgICBpZiAodGhpcy5ub2RlLnggPCAwICYmIHRoaXMubm9kZS55IDwgMCkgY3VycmVudGluZGV4ID0gLXRoaXMubm9kZS54ID4gLXRoaXMubm9kZS55ID8gNiA6IDdcclxuXHJcbiAgICAgICAgICAvLyDmoIforrDlvZPliY3kvY3nva7mmK/lkKbkuLrnqbpcclxuICAgICAgICAgIGxldCBpc2VtcHR5ID0gdHJ1ZVxyXG5cclxuICAgICAgICAgIC8vIOWcqOWvueW6lOWchueOr+W3suaUvue9rueahOaVsOe7hOS4reafpeaJvlxyXG4gICAgICAgICAgZ2xvYmFsLmJlc2lkZWJsb2Nrcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXRlbS5pbmRleCA9PSBjdXJyZW50aW5kZXgpIGlzZW1wdHkgPSBmYWxzZSAvLyDmib7liLDor7TmmI7lvZPliY3kvY3nva7kuI3lj6/nlKhcclxuICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgLy8g5b2T5YmN5L2N572u6Iul5Li656m6XHJcbiAgICAgICAgICBpZiAoaXNlbXB0eSAmJiB0aGlzLm5vZGUueCAhPSAwICYmIHRoaXMubm9kZS55ICE9IDApIHtcclxuXHJcbiAgICAgICAgICAgIC8v6K6h566X5peL6L2s6KeS5bqmXHJcbiAgICAgICAgICAgIGdsb2JhbC5NY2hhbmdlYW5nbGUgKz0gNDUgKiBwYXJzZUludCh0aGlzLmdhbWUucm90YXRlR3JpZHNNLnN0cmluZylcclxuXHJcbiAgICAgICAgICAgIC8v6K6h566X5Z2X55qE55yf5q2j5L2N572uXHJcbiAgICAgICAgICAgIGxldCBuID0gKGN1cnJlbnRpbmRleCArIGdsb2JhbC5NY2hhbmdlcG9zaXRpb24pICUgOFxyXG4gICAgICAgICAgICBpZiAobiA8IDApXHJcbiAgICAgICAgICAgICAgbiArPSA4XHJcblxyXG4gICAgICAgICAgICAvL+aUvue9ruWdl+eahOe8k+WKqOaViOaenFxyXG4gICAgICAgICAgICBjYy50d2Vlbih0aGlzLm5vZGUpLnRvKC4yLCB7XHJcbiAgICAgICAgICAgICAgeDogcG9pbnRzW2N1cnJlbnRpbmRleF0ueCxcclxuICAgICAgICAgICAgICB5OiBwb2ludHNbY3VycmVudGluZGV4XS55LFxyXG4gICAgICAgICAgICAgIGFuZ2xlOiBwb2ludHNbY3VycmVudGluZGV4XS5hLFxyXG4gICAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgZWFzaW5nOiAncXVhZEluJ1xyXG4gICAgICAgICAgICB9KS5jYWxsKCgpID0+IHtcclxuICAgICAgICAgICAgICAvL+aUvue9ruWdl1xyXG4gICAgICAgICAgICAgIHRoaXMubm9kZS54ID0gcG9pbnRzW25dLnhcclxuICAgICAgICAgICAgICB0aGlzLm5vZGUueSA9IHBvaW50c1tuXS55XHJcbiAgICAgICAgICAgICAgdGhpcy5ub2RlLmFuZ2xlID0gcG9pbnRzW25dLmFcclxuXHJcbiAgICAgICAgICAgICAgLy/mm7TmlLnlnZfnmoTniLboioLngrlcclxuICAgICAgICAgICAgICB0aGlzLm5vZGUucmVtb3ZlRnJvbVBhcmVudChmYWxzZSk7XHJcbiAgICAgICAgICAgICAgdGhpcy5nYW1lLmJlc2lkZS5hZGRDaGlsZCh0aGlzLm5vZGUpO1xyXG5cclxuICAgICAgICAgICAgICAvL+eOr+aXi+i9rOeahOe8k+WKqOaViOaenFxyXG4gICAgICAgICAgICAgIGNjLnR3ZWVuKHRoaXMuZ2FtZS5iZXNpZGUpLnRvKE1hdGguYWJzKHBhcnNlSW50KHRoaXMuZ2FtZS5yb3RhdGVHcmlkc00uc3RyaW5nKSkgLyA0LCB7XHJcbiAgICAgICAgICAgICAgICBhbmdsZTogZ2xvYmFsLk1jaGFuZ2VhbmdsZVxyXG4gICAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgIGVhc2luZzogJ3F1YWRJbidcclxuICAgICAgICAgICAgICB9KS5jYWxsKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5kZWxldGVCbG9jaygpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIOaSreaUvumfs+aViFxyXG4gICAgICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUucGxheUVmZmVjdCh0aGlzLmdhbWUucm90YXRlQXVkaW8sIGZhbHNlKTtcclxuICAgICAgICAgICAgICB9KS5zdGFydCgpXHJcbiAgICAgICAgICAgIH0pLnN0YXJ0KClcclxuXHJcbiAgICAgICAgICAgIC8vIOaehOmAoOW9k+WJjeWdl+eahOWvueixoe+8jOeUqOS6juS/neWtmOWcqOWchueOr+WvueixoeaVsOe7hOS4rVxyXG4gICAgICAgICAgICBsZXQgYmxvY2sgPSB7XHJcbiAgICAgICAgICAgICAgaW5kZXg6IGN1cnJlbnRpbmRleCwgLy8g5Z2X55qE5L2N572u5bqP5Y+3XHJcbiAgICAgICAgICAgICAgY29sb3I6IHRoaXMubm9kZS5jb2xvci5fdmFsLCAvLyDlnZfnmoTpopzoibJcclxuICAgICAgICAgICAgICByb3RhdGVHcmlkc006IHRoaXMuZ2FtZS5yb3RhdGVHcmlkc00uc3RyaW5nLCAvLyDlnZfnmoTovazliqjmoLzmlbBcclxuICAgICAgICAgICAgICBibG9ja2l0ZW06IHRoaXNcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8g5L+d5a2Y5Zyo5ZyG546v5a+56LGh5pWw57uE5LitXHJcbiAgICAgICAgICAgIGdsb2JhbC5iZXNpZGVibG9ja3MucHVzaChibG9jaylcclxuXHJcbiAgICAgICAgICAgIC8vIOaSreaUvumfs+aViFxyXG4gICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5wbGF5RWZmZWN0KHRoaXMuZ2FtZS5wbGFjZUF1ZGlvLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAvL+iuoeeul+WcqOaVsOe7hOS4reeahOS9jee9rlxyXG4gICAgICAgICAgICBnbG9iYWwuTWNoYW5nZXBvc2l0aW9uIC09IHBhcnNlSW50KHRoaXMuZ2FtZS5yb3RhdGVHcmlkc00uc3RyaW5nKVxyXG5cclxuICAgICAgICAgICAgLy/mm7TmlrDmlbDnu4TkuK3miYDmnInlnZfnmoTkvY3nva5cclxuICAgICAgICAgICAgZ2xvYmFsLmJlc2lkZWJsb2Nrcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgIGl0ZW0uaW5kZXggPSAoaXRlbS5pbmRleCArIHBhcnNlSW50KHRoaXMuZ2FtZS5yb3RhdGVHcmlkc00uc3RyaW5nKSkgJSA4XHJcbiAgICAgICAgICAgICAgaWYgKGl0ZW0uaW5kZXggPCAwKVxyXG4gICAgICAgICAgICAgICAgaXRlbS5pbmRleCArPSA4XHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiZ2xvYmFsLmJlc2lkZWJsb2NrczogXCIpXHJcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coZ2xvYmFsLmJlc2lkZWJsb2NrcylcclxuXHJcbiAgICAgICAgICAgIC8vIOWwhuW9k+WJjeWdl+iuvue9ruS4uuS4jeWPr+eCueWHu1xyXG4gICAgICAgICAgICB0aGlzLm5vZGUuYmxvY2t0eXBlID0gJ2Jlc2lkZSdcclxuXHJcbiAgICAgICAgICAgIC8vIOaUvue9ruasoeaVsOWKoDFcclxuICAgICAgICAgICAgZ2xvYmFsLmNvdW50KytcclxuXHJcbiAgICAgICAgICAgIC8vIOWmguaenOS4ieS4quWdl+Wdh+W3suaUvue9ruWujOavle+8jOWImemHjeaWsOeUn+aIkOS4ieS4quWdl1xyXG4gICAgICAgICAgICBpZiAoZ2xvYmFsLmNvdW50ICE9IDAgJiYgZ2xvYmFsLmNvdW50ICUgMyA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5nYW1lLnNwYXduQmxvY2soKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g5b2T5YmN5L2N572u6Iul5LiN5Li656m677yM56e75Yqo5Yiw5Yid5aeL5L2N572uXHJcbiAgICAgICAgICAgIGlmICh0b3VjaC5nZXRMb2NhdGlvbigpLnggLSB0aGlzLm5vZGUucGFyZW50LndpZHRoIC8gMiA8IDApXHJcbiAgICAgICAgICAgICAgdGhpcy5lYXNlVG8odGhpcy5fb2xkUG9zLngsIHRoaXMuX29sZFBvcy55LCAzMzcuNSwgLjIpXHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICB0aGlzLmVhc2VUbyh0aGlzLl9vbGRQb3MueCwgdGhpcy5fb2xkUG9zLnksIC0yMi41LCAuMilcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0sIHRoaXMpO1xyXG4gIH0sXHJcblxyXG4gIC8vIOe8k+WKqOWHveaVsFxyXG4gIGVhc2VUbzogZnVuY3Rpb24gKHgsIHksIGEsIHQpIHtcclxuICAgIGNjLnR3ZWVuKHRoaXMubm9kZSkudG8odCwge1xyXG4gICAgICBwb3NpdGlvbjogY2MudjIoeCwgeSksXHJcbiAgICAgIGFuZ2xlOiBhXHJcbiAgICB9LCB7XHJcbiAgICAgIGVhc2luZzogJ3F1YWRJbidcclxuICAgIH0pLnN0YXJ0KClcclxuICB9LFxyXG5cclxuXHJcbiAgb25EaXNhYmxlKCkge1xyXG4gICAgY2MuZGlyZWN0b3IuZ2V0Q29sbGlzaW9uTWFuYWdlcigpLmVuYWJsZWQgPSBmYWxzZTtcclxuICAgIGNjLmRpcmVjdG9yLmdldENvbGxpc2lvbk1hbmFnZXIoKS5lbmFibGVkRGVidWdEcmF3ID0gZmFsc2U7XHJcbiAgICB0aGlzLm5vZGUub2ZmKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX1NUQVJUKTtcclxuICAgIHRoaXMubm9kZS5vZmYoY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfTU9WRSk7XHJcbiAgICB0aGlzLm5vZGUub2ZmKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0VORCk7XHJcbiAgfSxcclxufSk7XHJcbiJdfQ==