{"version":3,"sources":["assets\\scripts\\largeBlock.js"],"names":["global","require","cc","Class","Component","properties","color","collider","type","PolygonCollider","blocktype","start","_oldPos","node","position","onLoad","director","getCollisionManager","enabled","hit","on","Node","EventType","TOUCH_START","touch","event","touchLoc","getLocation","Intersection","pointInPolygon","world","points","console","log","x","parent","width","y","height","TOUCH_MOVE","getDelta","angle","Math","atan","PI","TOUCH_END","currentindex","outsidepoints","easeTo","isempty","outsideblocks","forEach","item","index","Lchangeangle","parseInt","game","rotateGridsL","string","n","Lchangeposition","tween","to","a","easing","call","removeFromParent","outside","addChild","abs","deleteBlock","audioEngine","playEffect","rotateAudio","block","_val","blockitem","push","placeAudio","count","spawnBlock","t","v2","onDisable","enabledDebugDraw","off"],"mappings":"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","sourceRoot":"/","sourcesContent":["var global = require('global');\r\n\r\ncc.Class({\r\n  extends: cc.Component,\r\n  properties: {\r\n    color: '',\r\n    collider: {\r\n      default: null,\r\n      type: cc.PolygonCollider\r\n    },\r\n    blocktype: '',\r\n\r\n  },\r\n\r\n  start() {\r\n    this._oldPos = this.node.position;\r\n  },\r\n\r\n  onLoad() {\r\n    cc.director.getCollisionManager().enabled = true;\r\n    this.hit = false;\r\n\r\n    // 触摸事件开始\r\n    this.node.on(cc.Node.EventType.TOUCH_START, function (touch, event) {\r\n      var touchLoc = touch.getLocation();\r\n      if (cc.Intersection.pointInPolygon(touchLoc, this.collider.world.points)) {\r\n        console.log(this.node.blocktype);\r\n        this.hit = true;\r\n        // 启用缓动动画\r\n        // cc.tween(this.node).to(.15, {\r\n        //   position: cc.v2(touchLoc.x - this.node.parent.width / 2, touchLoc.y - this.node.parent.height / 2)\r\n        // }, {\r\n        //   easing: 'quadIn'\r\n        // }).start()\r\n        if (this.hit && this.node.blocktype == 'large') {\r\n          this.node.x = touchLoc.x - this.node.parent.width / 2\r\n          this.node.y = touchLoc.y - this.node.parent.height / 2\r\n        }\r\n      }\r\n    }, this);\r\n\r\n    // 触摸事件监听\r\n    this.node.on(cc.Node.EventType.TOUCH_MOVE, function (touch, event) {\r\n      var touchLoc = touch.getLocation();\r\n      if (this.hit && this.node.blocktype == 'large') {\r\n        this.node.x += touch.getDelta().x;\r\n        this.node.y += touch.getDelta().y;\r\n        touchLoc.x = touchLoc.x - this.node.parent.width / 2\r\n        touchLoc.y = touchLoc.y - this.node.parent.height / 2\r\n        if (touchLoc.x > 0 && touchLoc.y > 0) {\r\n          this.node.angle = Math.atan(touchLoc.y / touchLoc.x) / Math.PI * 180 + 90 - 22.5\r\n        } else if (touchLoc.x < 0 && touchLoc.y > 0) {\r\n          this.node.angle = Math.atan(-touchLoc.x / touchLoc.y) / Math.PI * 180 + 180 - 22.5\r\n        } else if (touchLoc.x < 0 && touchLoc.y < 0) {\r\n          this.node.angle = Math.atan(-touchLoc.y / -touchLoc.x) / Math.PI * 180 + 270 - 22.5\r\n        } else if (touchLoc.x > 0 && touchLoc.y < 0) {\r\n          this.node.angle = Math.atan(touchLoc.x / -touchLoc.y) / Math.PI * 180 - 22.5\r\n        } else if (touchLoc.x == 0 && touchLoc.y > 0) {\r\n          this.node.angle = 180 - 22.5\r\n        } else if (touchLoc.x == 0 && touchLoc.y < 0) {\r\n          this.node.angle = 0 - 22.5\r\n        } else if (touchLoc.x > 0 && touchLoc.y == 0) {\r\n          this.node.angle = 90 - 22.5\r\n        } else if (touchLoc.x < 0 && touchLoc.y == 0) {\r\n          this.node.angle = 270 - 22.5\r\n        }\r\n      }\r\n    }, this);\r\n\r\n    // 触摸事件结束\r\n    this.node.on(cc.Node.EventType.TOUCH_END, function (touch, event) {\r\n      if (this.hit && this.node.blocktype == 'large') {\r\n        this.hit = false;\r\n\r\n        // 记录当前放置的位置\r\n        let currentindex = -1;\r\n        const points = global.outsidepoints\r\n\r\n        // 没有移动到圆环目标位置区域，移动到初始位置\r\n        if (this.node.x * this.node.x + this.node.y * this.node.y > 1074 * 1074 / 4 || this.node.x * this.node\r\n          .x + this.node.y * this.node.y < 574 * 574 / 4) {\r\n\r\n          if (touch.getLocation().x - this.node.parent.width / 2 < 0)\r\n            this.easeTo(this._oldPos.x, this._oldPos.y, 337.5, .2)\r\n          else\r\n            this.easeTo(this._oldPos.x, this._oldPos.y, -22.5, .2)\r\n        } else {\r\n\r\n          // 移动到了圆环目标位置区域\r\n          if (this.node.x > 0 && this.node.y < 0) currentindex = this.node.x < -this.node.y ? 0 : 1\r\n          if (this.node.x > 0 && this.node.y > 0) currentindex = this.node.x > this.node.y ? 2 : 3\r\n          if (this.node.x < 0 && this.node.y > 0) currentindex = -this.node.x < this.node.y ? 4 : 5\r\n          if (this.node.x < 0 && this.node.y < 0) currentindex = -this.node.x > -this.node.y ? 6 : 7\r\n\r\n          // 标记当前位置是否为空\r\n          let isempty = true\r\n\r\n          // 在对应圆环已放置的数组中查找\r\n          global.outsideblocks.forEach(item => {\r\n            if (item.index == currentindex) isempty = false // 找到说明当前位置不可用\r\n          })\r\n\r\n          // 当前位置若为空\r\n          if (isempty && this.node.x != 0 && this.node.y != 0) {\r\n\r\n            //计算旋转角度\r\n            global.Lchangeangle += 45 * parseInt(this.game.rotateGridsL.string)\r\n\r\n            //计算块的真正位置\r\n            let n = (currentindex + global.Lchangeposition) % 8\r\n            if (n < 0)\r\n              n += 8\r\n\r\n            // //更改块的父节点\r\n            // this.node.removeFromParent(false);\r\n            // this.game.outside.addChild(this.node);\r\n\r\n            // //放置块\r\n            // this.node.x = points[n].x\r\n            // this.node.y = points[n].y\r\n            // this.node.angle = points[n].a\r\n\r\n            //放置块的缓动效果\r\n            cc.tween(this.node).to(.2, {\r\n              x: points[currentindex].x,\r\n              y: points[currentindex].y,\r\n              angle: points[currentindex].a,\r\n            }, {\r\n              easing: 'quadIn'\r\n            }).call(() => {\r\n              //放置块\r\n              this.node.x = points[n].x\r\n              this.node.y = points[n].y\r\n              this.node.angle = points[n].a\r\n\r\n              //更改块的父节点\r\n              this.node.removeFromParent(false);\r\n              this.game.outside.addChild(this.node);\r\n\r\n\r\n              //环旋转的缓动效果\r\n              cc.tween(this.game.outside).to(Math.abs(parseInt(this.game.rotateGridsL.string)) / 4, {\r\n                angle: global.Lchangeangle\r\n              }, {\r\n                easing: 'quadIn'\r\n              }).call(() => {\r\n                this.game.deleteBlock();\r\n\r\n                // 播放音效\r\n                cc.audioEngine.playEffect(this.game.rotateAudio, false);\r\n              }).start()\r\n            }).start()\r\n\r\n            // 构造当前块的对象，用于保存在圆环对象数组中\r\n            let block = {\r\n              index: currentindex, // 块的位置序号\r\n              color: this.node.color._val, // 块的颜色\r\n              rotateGridsL: this.game.rotateGridsL.string, // 块的转动格数\r\n              blockitem: this\r\n            }\r\n\r\n            console.log(block)\r\n            // 保存在圆环对象数组中\r\n            global.outsideblocks.push(block)\r\n\r\n            // 播放音效\r\n            cc.audioEngine.playEffect(this.game.placeAudio, false);\r\n\r\n            // //环旋转的缓动效果\r\n            // cc.tween(this.game.outside).to(Math.abs(parseInt(this.game.rotateGridsL.string)) / 4, {\r\n            //   angle: global.Lchangeangle\r\n            // }, {\r\n            //   easing: 'quadIn'\r\n            // }).call(() => {\r\n            //   this.game.deleteBlock();\r\n\r\n            //   // 播放音效\r\n            //   cc.audioEngine.playEffect(this.game.rotateAudio, false);\r\n            // }).start()\r\n\r\n            //计算在数组中的位置\r\n            global.Lchangeposition -= parseInt(this.game.rotateGridsL.string)\r\n\r\n            //更新数组中所有块的位置\r\n            global.outsideblocks.forEach(item => {\r\n              item.index = (item.index + parseInt(this.game.rotateGridsL.string)) % 8;\r\n              if (item.index < 0)\r\n                item.index += 8\r\n            })\r\n\r\n            //console.log(\"global.outsideblocks: \")\r\n            //console.log(global.outsideblocks)\r\n\r\n            // 将当前块设置为不可点击\r\n            this.node.blocktype = 'outside'\r\n\r\n            // 放置次数加1\r\n            global.count++\r\n\r\n            // 如果三个块均已放置完毕，则重新生成三个块\r\n            if (global.count != 0 && global.count % 3 == 0) {\r\n              this.game.spawnBlock();\r\n            }\r\n          } else {\r\n            // 当前位置若不为空，移动到初始位置\r\n            if (touch.getLocation().x - this.node.parent.width / 2 < 0)\r\n              this.easeTo(this._oldPos.x, this._oldPos.y, 337.5, .2)\r\n            else\r\n              this.easeTo(this._oldPos.x, this._oldPos.y, -22.5, .2)\r\n          }\r\n        }\r\n      }\r\n    }, this);\r\n  },\r\n\r\n  // 缓动函数\r\n  easeTo: function (x, y, a, t) {\r\n    cc.tween(this.node).to(t, {\r\n      position: cc.v2(x, y),\r\n      angle: a\r\n    }, {\r\n      easing: 'quadIn'\r\n    }).start()\r\n  },\r\n\r\n  onDisable() {\r\n    cc.director.getCollisionManager().enabled = false;\r\n    cc.director.getCollisionManager().enabledDebugDraw = false;\r\n    this.node.off(cc.Node.EventType.TOUCH_START);\r\n    this.node.off(cc.Node.EventType.TOUCH_MOVE);\r\n    this.node.off(cc.Node.EventType.TOUCH_END);\r\n  },\r\n\r\n\r\n});\r\n"]}